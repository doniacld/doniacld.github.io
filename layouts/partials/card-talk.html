<article class="card card--talk">
  {{/* YouTube embed if video_url contains youtube */}}
  {{ $isYouTube := false }}
  {{ with .Params.video_url }}
    {{ if findRE "youtube|youtu.be" . }}
      {{ $isYouTube = true }}
      {{ $videoId := replaceRE ".*(?:youtu\\.be/|youtube\\.com/(?:embed/|v/|watch\\?v=|watch\\?.+&v=))([^&?#]+).*" "$1" . }}
      <div class="card__video">
        <iframe 
          src="https://www.youtube.com/embed/{{ $videoId }}" 
          title="{{ $.Title }}" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen
          loading="lazy">
        </iframe>
      </div>
    {{ end }}
  {{ end }}
  {{/* Cover image when no YouTube video */}}
  {{ if not $isYouTube }}
    {{ with .Params.cover_image }}
    <div class="card__cover">
      <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
    </div>
    {{ end }}
  {{ end }}
  
  <div class="card__content">
    <h3 class="card__title">
      <a href="{{ .Permalink }}">{{ .Title }}</a>
    </h3>
    <div class="card__meta">
      {{ with .Params.event }}{{ . }} &bull; {{ end }}{{ .Date.Format "2006" }}
      {{ with .Params.location }} &bull; {{ . }}{{ end }}
    </div>
    <p class="card__summary">
      {{ with .Params.summary }}{{ . }}{{ else }}{{ .Summary | plainify | truncate 120 }}{{ end }}
    </p>
    <div class="card__footer">
      {{ with .Params.tags }}
      <div class="tags">
        {{ range first 2 . }}
        <span class="tag">{{ . }}</span>
        {{ end }}
      </div>
      {{ end }}
    <div class="card__links">
      {{ with .Params.video_url }}
      <a href="{{ . }}" class="card__link" target="_blank" rel="noopener">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
        Video
      </a>
      {{ end }}
      {{ with .Params.slides_url }}
      <a href="{{ . }}" class="card__link" target="_blank" rel="noopener">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
        Slides
      </a>
      {{ end }}
      {{ with .Params.event_url }}
      <a href="{{ . }}" class="card__link" target="_blank" rel="noopener">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
        Event
      </a>
      {{ end }}
    </div>
    </div>
  </div>
</article>
