<article class="card card--podcast">
  {{/* YouTube embed if video_url contains youtube */}}
  {{ $isYouTube := false }}
  {{ with .Params.video_url }}
    {{ if findRE "youtube|youtu.be" . }}
      {{ $isYouTube = true }}
      {{ $videoId := replaceRE ".*(?:youtu\\.be/|youtube\\.com/(?:embed/|v/|watch\\?v=|watch\\?.+&v=))([^&?#]+).*" "$1" . }}
      <div class="card__video">
        <iframe 
          src="https://www.youtube.com/embed/{{ $videoId }}" 
          title="{{ $.Title }}" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen
          loading="lazy">
        </iframe>
      </div>
    {{ end }}
  {{ end }}
  {{/* Cover image when no YouTube video */}}
  {{ if not $isYouTube }}
    {{ with .Params.cover_image }}
    <div class="card__cover">
      <img src="{{ . }}" alt="{{ $.Title }}" loading="lazy">
    </div>
    {{ end }}
  {{ end }}
  
  <div class="card__content">
    <h3 class="card__title">
      <a href="{{ .Permalink }}">{{ .Title }}</a>
    </h3>
    <div class="card__meta">
      {{ with .Params.podcast }}{{ . }} &bull; {{ end }}{{ .Date.Format "Jan 2006" }}
      {{ with .Params.role }}&bull; <span class="card__role card__role--{{ . }}">{{ if eq . "guest" }}Guest{{ else if eq . "host" }}Host{{ end }}</span>{{ end }}
    </div>
    <p class="card__summary">
      {{ with .Params.summary }}{{ . }}{{ else }}{{ .Summary | plainify | truncate 120 }}{{ end }}
    </p>
    <div class="card__footer">
      {{ with .Params.tags }}
      <div class="tags">
        {{ range first 2 . }}
        <span class="tag">{{ . }}</span>
        {{ end }}
      </div>
      {{ end }}
      <div class="card__links">
        {{ with .Params.video_url }}
        <a href="{{ . }}" class="card__link" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
          Watch
        </a>
        {{ end }}
        {{ with .Params.episode_url }}
        <a href="{{ . }}" class="card__link" target="_blank" rel="noopener">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
          Listen
        </a>
        {{ end }}
      </div>
    </div>
  </div>
</article>
